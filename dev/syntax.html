<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Syntax - RSLint docs</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> RSLint</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../user/config.html"><strong aria-hidden="true">1.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../user/directives.html"><strong aria-hidden="true">1.2.</strong> Directives</a></li></ol></li><li class="chapter-item expanded "><a href="../dev/index.html"><strong aria-hidden="true">2.</strong> Dev Docs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dev/project_layout.html"><strong aria-hidden="true">2.1.</strong> Project Layout</a></li><li class="chapter-item expanded "><a href="../dev/rules.html"><strong aria-hidden="true">2.2.</strong> Rules</a></li><li class="chapter-item expanded "><a href="../dev/syntax.html" class="active"><strong aria-hidden="true">2.3.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="../dev/docgen.html"><strong aria-hidden="true">2.4.</strong> Docgen</a></li></ol></li><li class="chapter-item expanded "><a href="../rules/index.html"><strong aria-hidden="true">3.</strong> Rules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rules/errors/index.html"><strong aria-hidden="true">3.1.</strong> errors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rules/errors/for-direction.html"><strong aria-hidden="true">3.1.1.</strong> for-direction</a></li><li class="chapter-item expanded "><a href="../rules/errors/getter-return.html"><strong aria-hidden="true">3.1.2.</strong> getter-return</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-async-promise-executor.html"><strong aria-hidden="true">3.1.3.</strong> no-async-promise-executor</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-await-in-loop.html"><strong aria-hidden="true">3.1.4.</strong> no-await-in-loop</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-compare-neg-zero.html"><strong aria-hidden="true">3.1.5.</strong> no-compare-neg-zero</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-cond-assign.html"><strong aria-hidden="true">3.1.6.</strong> no-cond-assign</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-constant-condition.html"><strong aria-hidden="true">3.1.7.</strong> no-constant-condition</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-debugger.html"><strong aria-hidden="true">3.1.8.</strong> no-debugger</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-dupe-keys.html"><strong aria-hidden="true">3.1.9.</strong> no-dupe-keys</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-duplicate-cases.html"><strong aria-hidden="true">3.1.10.</strong> no-duplicate-cases</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-empty.html"><strong aria-hidden="true">3.1.11.</strong> no-empty</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-extra-boolean-cast.html"><strong aria-hidden="true">3.1.12.</strong> no-extra-boolean-cast</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-extra-semi.html"><strong aria-hidden="true">3.1.13.</strong> no-extra-semi</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-inner-declarations.html"><strong aria-hidden="true">3.1.14.</strong> no-inner-declarations</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-irregular-whitespace.html"><strong aria-hidden="true">3.1.15.</strong> no-irregular-whitespace</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-prototype-builtins.html"><strong aria-hidden="true">3.1.16.</strong> no-prototype-builtins</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-setter-return.html"><strong aria-hidden="true">3.1.17.</strong> no-setter-return</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-sparse-arrays.html"><strong aria-hidden="true">3.1.18.</strong> no-sparse-arrays</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unexpected-multiline.html"><strong aria-hidden="true">3.1.19.</strong> no-unexpected-multiline</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unsafe-finally.html"><strong aria-hidden="true">3.1.20.</strong> no-unsafe-finally</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unsafe-negation.html"><strong aria-hidden="true">3.1.21.</strong> no-unsafe-negation</a></li><li class="chapter-item expanded "><a href="../rules/errors/use-isnan.html"><strong aria-hidden="true">3.1.22.</strong> use-isnan</a></li><li class="chapter-item expanded "><a href="../rules/errors/valid-typeof.html"><strong aria-hidden="true">3.1.23.</strong> valid-typeof</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">RSLint docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#untyped-syntax-nodes" id="untyped-syntax-nodes">Untyped syntax nodes</a></h1>
<p>Traditionally, linters operate directly on an AST. This works fine for most cases if you have a visitor, however, it is too constrained for a powerful linter. ASTs have very significant downsides which include: </p>
<ul>
<li>Often expensive to clone and pass around </li>
<li>Node traversal is impossible without runtime typing, and even with runtime typing it is extremely constrained. </li>
<li>No straightforward way to obtain individual tokens or child nodes</li>
<li>Lossy, no way to cleanly and efficiently represent whitespace inside of them, which is crucial for stylistic linting.</li>
<li>Require explicit handling of their structures in the parser</li>
<li>Mutable, which is fine for most cases but you really do not want mutable trees for static analysis in a language without a GC. </li>
<li>No way to go back to source without a formatter or expensive storage of original source code</li>
<li>Makes error recovery for a parser very constrained </li>
</ul>
<p>To counteract this, RSLint uses a significantly different representation for ASTs, which are called green trees/syntax nodes. At the core, a tree
is immutable and is represented by an immutable &quot;green tree&quot;, a tree consists of green nodes which contain children, which can be green nodes and green tokens. <a href="https://docs.rs/rowan/0.10.0/rowan/api/struct.SyntaxNode.html">Syntax nodes</a> are wrappers consisting of a <code>Rc</code> housing some node data in the green tree. <a href="https://docs.rs/rowan/0.10.0/rowan/api/struct.SyntaxToken.html">Syntax tokens</a> are the same thing but for tokens in the green tree. This means our AST and nodes are all immutable, it also means we can cheaply clone nodes and tokens and pass them around to individual analyzers (e.g. scope analysis) and functions without worrying about memory usage. Nodes and tokens are untyped, which means traversal of the syntax tree from a token is dead simple as you can see from the documentation on syntax node. This gets rid of the issue of complex node traversal being nearly impossible in typed ASTs.</p>
<p>Well does this really make a difference you might be asking. It sure does! for example, the deno_lint (a traditional AST based linter) logic for <a href="../rules/errors/no-await-in-loop.html">no-await-in-loop</a> is <a href="https://github.com/denoland/deno_lint/blob/master/src/rules/no_await_in_loop.rs">235 lines</a>, while the rslint logic is <a href="https://github.com/RDambrosio016/RSLint/blob/dev/rslint_core/src/groups/errors/no_await_in_loop.rs">35 lines</a>. This is because deno lint cannot get the ancestors of an ast node so it has to take a recursive top-down approach, handling every possible async function case. Instead, with untyped nodes we can freely get the ancestors and check them recursively. </p>
<p>Obviously, linting also requires typed structures, in this case, typed AST nodes are simple wrappers on top of a single syntax node. AST nodes simply define functions which traverse the node and get specific productions, which are then casted to another node. The conversion to and from untyped to typed is zero cost, which is great for a parallelized linter which needs to share AST nodes. Another thing about AST nodes is each function for properties returns an optional value (or iterator), because unlike other linters, rslint can fully recover from pretty much all parser errors and still lint the resulting tree. </p>
<p>Moreover, untyped nodes allow us to grab specific parts of a node, which is particularly important for rslint because it tries to emit the best diagnostics possible, which involves labeling specific parts.</p>
<p>And finally, untyped nodes can be lowered down to both lossy and lossless tokens, which allow us to do many cool things not doable without storing all tokens, which is expensive without interning (green trees do this automatically). These include:</p>
<ul>
<li>Lexical equality, which is better than string equality, because according to string equality, <code>foo .bar</code> and <code>foo.bar</code> are different </li>
<li>Lexical syntax highlighting (you can see this in action using <code>rslint explain some-rule-here</code>) </li>
<li>Lexical checking, such as being able to check the function name with <code>&amp;[&quot;Object&quot;, &quot;.&quot;, &quot;defineProperty&quot;]</code> </li>
<li>Easy whitespace checking</li>
<li>Easy comment checking</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../dev/rules.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../dev/docgen.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../dev/rules.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../dev/docgen.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
