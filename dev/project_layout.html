<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Project Layout - RSLint docs</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> RSLint</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../user/config.html"><strong aria-hidden="true">1.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../user/directives.html"><strong aria-hidden="true">1.2.</strong> Directives</a></li></ol></li><li class="chapter-item expanded "><a href="../dev/index.html"><strong aria-hidden="true">2.</strong> Dev Docs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dev/project_layout.html" class="active"><strong aria-hidden="true">2.1.</strong> Project Layout</a></li><li class="chapter-item expanded "><a href="../dev/rules.html"><strong aria-hidden="true">2.2.</strong> Rules</a></li><li class="chapter-item expanded "><a href="../dev/syntax.html"><strong aria-hidden="true">2.3.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="../dev/docgen.html"><strong aria-hidden="true">2.4.</strong> Docgen</a></li></ol></li><li class="chapter-item expanded "><a href="../rules/index.html"><strong aria-hidden="true">3.</strong> Rules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rules/errors/index.html"><strong aria-hidden="true">3.1.</strong> errors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rules/errors/for-direction.html"><strong aria-hidden="true">3.1.1.</strong> for-direction</a></li><li class="chapter-item expanded "><a href="../rules/errors/getter-return.html"><strong aria-hidden="true">3.1.2.</strong> getter-return</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-async-promise-executor.html"><strong aria-hidden="true">3.1.3.</strong> no-async-promise-executor</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-await-in-loop.html"><strong aria-hidden="true">3.1.4.</strong> no-await-in-loop</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-compare-neg-zero.html"><strong aria-hidden="true">3.1.5.</strong> no-compare-neg-zero</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-cond-assign.html"><strong aria-hidden="true">3.1.6.</strong> no-cond-assign</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-constant-condition.html"><strong aria-hidden="true">3.1.7.</strong> no-constant-condition</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-debugger.html"><strong aria-hidden="true">3.1.8.</strong> no-debugger</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-dupe-keys.html"><strong aria-hidden="true">3.1.9.</strong> no-dupe-keys</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-duplicate-cases.html"><strong aria-hidden="true">3.1.10.</strong> no-duplicate-cases</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-empty.html"><strong aria-hidden="true">3.1.11.</strong> no-empty</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-extra-boolean-cast.html"><strong aria-hidden="true">3.1.12.</strong> no-extra-boolean-cast</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-extra-semi.html"><strong aria-hidden="true">3.1.13.</strong> no-extra-semi</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-inner-declarations.html"><strong aria-hidden="true">3.1.14.</strong> no-inner-declarations</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-irregular-whitespace.html"><strong aria-hidden="true">3.1.15.</strong> no-irregular-whitespace</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-prototype-builtins.html"><strong aria-hidden="true">3.1.16.</strong> no-prototype-builtins</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-setter-return.html"><strong aria-hidden="true">3.1.17.</strong> no-setter-return</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-sparse-arrays.html"><strong aria-hidden="true">3.1.18.</strong> no-sparse-arrays</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unexpected-multiline.html"><strong aria-hidden="true">3.1.19.</strong> no-unexpected-multiline</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unsafe-finally.html"><strong aria-hidden="true">3.1.20.</strong> no-unsafe-finally</a></li><li class="chapter-item expanded "><a href="../rules/errors/no-unsafe-negation.html"><strong aria-hidden="true">3.1.21.</strong> no-unsafe-negation</a></li><li class="chapter-item expanded "><a href="../rules/errors/use-isnan.html"><strong aria-hidden="true">3.1.22.</strong> use-isnan</a></li><li class="chapter-item expanded "><a href="../rules/errors/valid-typeof.html"><strong aria-hidden="true">3.1.23.</strong> valid-typeof</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">RSLint docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#project-layout" id="project-layout">Project Layout</a></h1>
<p>RSLint is a monorepo (workspace), this allows us to distinctly separate logic and redistibute some of that logic as crates.
The actual bulk of linting is done in <code>rslint_core</code>, which is where all rules are implemented.</p>
<h2><a class="header" href="#linting-flow" id="linting-flow">Linting Flow</a></h2>
<p>Linting consists of distinct steps, which are separated into crates to avoid a single messy crate.</p>
<p>This is a simplified summary of the linting process:</p>
<pre><code>CLI parsing --&gt; File walker --&gt; Lexing --&gt; Parsing --&gt; Linting --&gt; Result collection --&gt; Diagnostic emission
    |                                                     |
    v                                                     v
Config parsing                                      Scope analysis
</code></pre>
<h2><a class="header" href="#rslint_cli" id="rslint_cli">rslint_cli</a></h2>
<p>Linting starts with <a href="https://github.com/RDambrosio016/RSLint/tree/master/crates/rslint_cli"><code>rslint_cli</code></a>. Its jobs include the following:</p>
<ul>
<li>CLI arg parsing</li>
<li>Configuration parsing</li>
<li>File loading</li>
<li>Calling the lint runner</li>
<li>Emitting results/diagnostics</li>
</ul>
<p>The crate starts by trying to load the configuration file, this is done by spawning a thread which will try to load
the <code>rslintrc.toml</code> file and returning a handle to it. Then it will instantiate the <code>FileWalker</code>, this is the structure
which manages loading files from disk, it does so concurrently by spawning one thread per file being loaded.</p>
<p>From then on it will collect the rules it needs to run from the config, and it will call the <code>lint_file</code> function from the <code>rslint_core</code> crate.</p>
<h2><a class="header" href="#rslint_core" id="rslint_core">rslint_core</a></h2>
<p>This is the crate where all the magic happens, it contains every rule plus general utilities. <code>rslint_core</code> should never know about CLI logic.
The point of separating the core linter logic and the cli logic is to allow rust users to run the linter on pieces of code without having to worry
about the overhead of CLI/binary logic.</p>
<p>The core structure (well, trait) of <code>rslint_core</code> is <code>CstRule</code>. <code>CstRule</code> is a trait describing a rule which is run on the concrete syntax tree of a single
file. A rule can operate on nodes, tokens, or the root node of a tree. You will notice there is no mention of a visitor anywhere, you can learn why <a href="./syntax.html">here</a>.</p>
<p>It is <strong>very</strong> important that each rule be Send and Sync, because rules are run highly parallel. (the linter will eventually have a type of rule which is run on all of the CSTs of each file). Most rules run on nodes, therefore use <code>check_node</code>, however, some need to check the token or the root, which is why <code>check_token</code> and <code>check_root</code> exist.</p>
<p>As for running rules, the linter starts by taking the source code, and parsing it into a syntax tree using <a href="https://github.com/RDambrosio016/RSLint/tree/master/crates/rslint_parser"><code>rslint_parser</code></a>. It then uses rayon to run every rule in the <code>CstRuleStore</code> in parallel. Syntax nodes are not thread safe because they are backed by an Rc, however we can pass a pointer to a green tree and reconstruct the root syntax node. For each descendant in the root node the linter runs each rule in parallel, each rule gets a new context instance, this instance will be used by the rule to attach diagnostics to it.</p>
<h2><a class="header" href="#rslint_lexer" id="rslint_lexer">rslint_lexer</a></h2>
<p><code>rslint_lexer</code> is a standard JavaScript lexer, it can also do ANSI syntax highlighting. The lexer is lookup table based, and it contains a decent amount of unsafe to make it stupidly fast, if you are working on it you should be quite careful and include safety comments for any unsafe usage.</p>
<h2><a class="header" href="#rslint_parser" id="rslint_parser">rslint_parser</a></h2>
<p>The parser is the heart of a linter, you can find a complete list of features but the most distinguished ones are:</p>
<ul>
<li>Speed</li>
<li>Complete error recovery</li>
<li>Simple parsing without explicitly handling AST nodes</li>
<li>Rich utilities</li>
<li>(WIP) incremental reparsing</li>
</ul>
<p>The concepts for the parser and the syntax it produces are taken from <a href="https://github.com/rust-analyzer/rust-analyzer">rust analyzer</a> and its syntax library, <a href="https://docs.rs/rowan/0.10.0/rowan/index.html">rowan</a>. You can read about the syntax concepts <a href="./syntax.html">here</a> and in the <a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/syntax.md">rust analyzer docs</a>.</p>
<p>The parser is by no means tied to the linter, it knows nothing about the linter, therefore you are free to reuse it for any projects.</p>
<h2><a class="header" href="#rslint_scope" id="rslint_scope">rslint_scope</a></h2>
<p><code>rslint_scope</code> is the scope analysis library. It produces a scope which contains items such as declared variables, variable refs, and child scopes. The scope analysis library tries to be as detailed as possible, most items are wrapped in Rcs or Weaks which allow it to refer back to declarations or parent scopes.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../dev/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../dev/rules.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../dev/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../dev/rules.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
